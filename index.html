<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>PDF Flipbook</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: black;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        #flipbook {
            position: relative;
            perspective: 1000px;
        }
        #pdf-canvas {
            width: 574.43px;
            height: auto;
            border: 1px solid white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.5s ease, opacity 0.3s ease;
            opacity: 1;
        }
        #pdf-canvas.out {
            transform: translate(-50%, -50%) translateX(100%) rotateY(20deg);
            opacity: 0;
        }
        #pdf-canvas.in {
            transform: translate(-50%, -50%) translateX(-100%) rotateY(-20deg);
            opacity: 0;
        }
    </style>
</head>
<body>
    <div id="flipbook">
        <canvas id="pdf-canvas"></canvas>
    </div>
    <audio id="page-turn-sound" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        const pdfFiles = [
            'page1.pdf', 'page2.pdf', 'page3.pdf', 'page4.pdf', 'page5.pdf',
            'page6.pdf', 'page7.pdf', 'page8.pdf', 'page9.pdf', 'page10.pdf',
            'page11.pdf', 'page12.pdf', 'page13.pdf', 'page14.pdf', 'page15.pdf',
            'page16.pdf', 'page17.pdf', 'page18.pdf', 'page19.pdf', 'page20.pdf',
            'page21.pdf', 'page22.pdf', 'page23.pdf', 'page24.pdf', 'page25.pdf',
            'page26.pdf', 'page27.pdf', 'page28.pdf', 'page29.pdf', 'page30.pdf',
            'page31.pdf', 'page32.pdf', 'page33.pdf'
        ];
        let currentIndex = 0;
        const canvas = document.getElementById('pdf-canvas');
        const context = canvas.getContext('2d');
        const pageTurnSound = document.getElementById('page-turn-sound');
        let scale = 1.0;
        const TARGET_WIDTH = 574.43;

        async function loadPage(index) {
            const pdfDoc = await pdfjsLib.getDocument(pdfFiles[index]).promise;
            const page = await pdfDoc.getPage(1);
            const viewport = page.getViewport({ scale: 1.0 });
            scale = TARGET_WIDTH / viewport.width;
            const adjustedViewport = page.getViewport({ scale: scale });
            canvas.height = adjustedViewport.height;
            canvas.width = adjustedViewport.width;
            canvas.style.width = `${TARGET_WIDTH}px`;
            canvas.style.height = `${adjustedViewport.height}px`;
            const renderContext = {
                canvasContext: context,
                viewport: adjustedViewport
            };
            await page.render(renderContext).promise;
            console.log(`Loaded page: ${pdfFiles[index]}, rendered width: ${TARGET_WIDTH}px, rendered height: ${adjustedViewport.height}px`);
        }

        async function turnPage(direction) {
            const oldCanvas = canvas.cloneNode();
            oldCanvas.className = 'out';
            canvas.parentNode.appendChild(oldCanvas);
            context.clearRect(0, 0, canvas.width, canvas.height);
            if (direction === 'next' && currentIndex < pdfFiles.length - 1) {
                currentIndex++;
                canvas.className = 'in';
                await loadPage(currentIndex);
                canvas.className = '';
                pageTurnSound.play();
            } else if (direction === 'prev' && currentIndex > 0) {
                currentIndex--;
                canvas.className = 'in';
                await loadPage(currentIndex);
                canvas.className = '';
                pageTurnSound.play();
            }
            setTimeout(() => oldCanvas.remove(), 500);
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            if (clickX < rect.width / 2 && currentIndex > 0) {
                turnPage('prev');
            } else if (clickX >= rect.width / 2 && currentIndex < pdfFiles.length - 1) {
                turnPage('next');
            }
        });

        window.addEventListener('resize', () => loadPage(currentIndex));

        loadPage(currentIndex);
    </script>
</body>
</html>